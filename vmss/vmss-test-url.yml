# Description
# ===========
# Use this playbook to test URL on all VMs in the scaleset.
# Use vmss-create and vmss-setup-tomcat playbooks to create VMSS and install Tomcat first
# This sample requires Ansible 2.6 

---
- hosts: localhost
  vars:
    resource_group: zimsvmssrg
    scaleset_name: zimsvmss
    loadbalancer_name: zimsvmsslb

  tasks:   
  tasks:   
    - include: get-hosts-tasks.yml

- hosts: scalesethosts
  tasks: 
    - name: Try to access Tomcat on specific VM
      uri:
        url: http://127.0.0.1:8080/
        method: GET
      register: output

    - name: Dump output
      debug:
        var: output
